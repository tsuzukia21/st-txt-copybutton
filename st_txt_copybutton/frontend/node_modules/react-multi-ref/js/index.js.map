{"version":3,"file":"index.js","names":["MultiRef","exports","_classCallCheck2","_defineProperty2","Map","_classPrivateFieldInitSpec","_refFns","_createClass2","key","value","ref","_this","refFn","_classPrivateFieldGet","get","map","set"],"sources":["../src/index.js"],"sourcesContent":["/* @flow */\n\ntype RefFn<V> = (value: V|null) => mixed;\n\nexport default class MultiRef<K,V> {\n  map: Map<K,V> = new Map();\n\n  #refFns: Map<K,RefFn<V>> = new Map();\n\n  ref(key: K): RefFn<V> {\n    const refFn = this.#refFns.get(key);\n    if (refFn) {\n      return refFn;\n    } else {\n      const refFn: RefFn<V> = value => {\n        if (value == null) {\n          // Support for React <=18, which cleans up ref functions by calling them\n          // with null.\n          this.#refFns.delete(key);\n          this.map.delete(key);\n        } else {\n          this.#refFns.set(key, refFn);\n          this.map.set(key, value);\n          // React 19+ cleanup support\n          return () => {\n            this.#refFns.delete(key);\n            this.map.delete(key);\n          };\n        }\n      };\n      // We don't put `refFn` into `this._refFns` yet, because if the current render\n      // is aborted, then it's possible than `refFn(null)` won't be called later\n      // and its cleanup will never happen. We shouldn't cause any side effects that\n      // need cleaning up later until `refFn` gets called with a non-null value.\n      return refFn;\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;IAIqBA,QAAQ,GAAAC,OAAA;EAAA,SAAAD,SAAA;IAAA,IAAAE,gBAAA,mBAAAF,QAAA;IAAA,IAAAG,gBAAA,0BACX,IAAIC,GAAG,CAAC,CAAC;IAAAC,0BAAA,OAAAC,OAAA,EAEE,IAAIF,GAAG,CAAC,CAAC;EAAA;EAAA,WAAAG,aAAA,aAAAP,QAAA;IAAAQ,GAAA;IAAAC,KAAA,EAEpC,SAAAC,IAAIF,GAAM,EAAY;MAAA,IAAAG,KAAA;MACpB,IAAMC,KAAK,GAAGC,qBAAA,CAAAP,OAAA,MAAI,EAASQ,GAAG,CAACN,GAAG,CAAC;MACnC,IAAII,KAAK,EAAE;QACT,OAAOA,KAAK;MACd,CAAC,MAAM;QACL,IAAMA,MAAe,GAAG,SAAlBA,MAAeA,CAAGH,KAAK,EAAI;UAC/B,IAAIA,KAAK,IAAI,IAAI,EAAE;YACjB;YACA;YACAI,qBAAA,CAAAP,OAAA,EAAAK,KAAI,WAAe,CAACH,GAAG,CAAC;YACxBG,KAAI,CAACI,GAAG,UAAO,CAACP,GAAG,CAAC;UACtB,CAAC,MAAM;YACLK,qBAAA,CAAAP,OAAA,EAAAK,KAAI,EAASK,GAAG,CAACR,GAAG,EAAEI,MAAK,CAAC;YAC5BD,KAAI,CAACI,GAAG,CAACC,GAAG,CAACR,GAAG,EAAEC,KAAK,CAAC;YACxB;YACA,OAAO,YAAM;cACXI,qBAAA,CAAAP,OAAA,EAAAK,KAAI,WAAe,CAACH,GAAG,CAAC;cACxBG,KAAI,CAACI,GAAG,UAAO,CAACP,GAAG,CAAC;YACtB,CAAC;UACH;QACF,CAAC;QACD;QACA;QACA;QACA;QACA,OAAOI,MAAK;MACd;IACF;EAAC;AAAA","ignoreList":[]}